<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Golang写一个简单的键值存储系统</title>
  <meta property="og:title" content="Golang写一个简单的键值存储系统" />
  <meta name="twitter:title" content="Golang写一个简单的键值存储系统" />
  <meta name="description" content="利用 golang 中的 map 数据结构写一个带超时限制的键值存储组件

">
  <meta property="og:description" content="利用 golang 中的 map 数据结构写一个带超时限制的键值存储组件

">
  <meta name="twitter:description" content="利用 golang 中的 map 数据结构写一个带超时限制的键值存储组件

">
  <meta name="author" content="Gopherzhang"/>
  <link href='https://driverzhang.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://driverzhang.github.io/img/gopher-head.png" />
  <meta name="twitter:image" content="https://driverzhang.github.io/img/gopher-head.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://driverzhang.github.io/post/golang%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%94%AE%E5%80%BC%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Gopherzhang" />

  <meta name="generator" content="Hugo 0.48" />
  <link rel="canonical" href="https://driverzhang.github.io/post/golang%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%94%AE%E5%80%BC%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" />
  <link rel="alternate" href="https://driverzhang.github.io/index.xml" type="application/rss+xml" title="Gopherzhang">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://driverzhang.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://driverzhang.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://driverzhang.github.io/css/codeblock.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://driverzhang.github.io/">Gopherzhang</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="tags" href="/tags/">tags</a>
            </li>
          
        
          
            <li>
              <a title="my life" href="/life/">my life</a>
            </li>
          
        
          
            <li>
              <a title="about me" href="/about/">about me</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">gitbooks</a>
              <div class="navlinks-children">
                
                  <a href="https://chai2010.gitbooks.io/advanced-go-programming-book/content/">Advanced Go Programming</a>
                
                  <a href="https://jimmysong.io/kubernetes-handbook/">Kubernetes Handbook</a>
                
                  <a href="https://books.studygolang.com/gopl-zh/index.html">The Go Programming Language</a>
                
              </div>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Gopherzhang" href="https://driverzhang.github.io/">
            <img class="avatar-img" src="https://driverzhang.github.io/img/gopher-head.png" alt="Gopherzhang" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Golang写一个简单的键值存储系统</h1>
                
                
                  <span class="post-meta">
  
  
  <i class="fa fa-calendar-o"></i>&nbsp;Posted on February 11, 2020
  
  
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>利用 golang 中的 map 数据结构写一个带超时限制的键值存储组件</p>

<p></p>

<h1 id="包括功能说明">包括功能说明</h1>

<h3 id="基础的增删改查">基础的增删改查</h3>

<ul>
<li>Set(k string, x interface{}, d time.Duration) : 新建立带时间限制的键值对，时间传0则不设置超时限制</li>
<li>SetDefault(k string, x interface{})：新建一个无超时的键值对</li>
<li>Add(k string, x interface{}, d time.Duration)：新增一个不存在的 键值对（判断是否存在该Key）</li>
<li>Replace(k string, x interface{}, d time.Duration)：替换 已经存在 键的值</li>
<li>Get(k string) (interface{}, bool)：查询一个键值对</li>
<li>GetWithExpiration(k string) (interface{}, time.Time, bool)： 查询该键对应的 值，过期时间，是否存在 （不存在则不再返回超时时间和值）</li>
<li>Delete(k string)： 删除键值</li>
<li>DeleteExpired()： 删除所有 超时的 键值</li>
<li>Flush() : 清楚所有键值对。（包括超时和未超时的所有）</li>
</ul>

<p>额外功能：</p>

<ul>
<li>OnEvicted(f func(string, interface{}))：删除 键值对后 做一些回调事件</li>
<li>Items() map[string]Item ：返回所有未超时的 副本键值</li>
<li>ItemCount() int： 返回对应所有的键值总数（包括超时的）</li>
<li>Increment(k string, n int64)： 对存在的键的值，做增加操作</li>
<li>Decrement(k string, n int64)：对存在的键的值，做减法操作</li>
</ul>

<h3 id="带超时时间限制">带超时时间限制</h3>

<ul>
<li><p>每个键值对可以设置对应的超时限制，如果没设置，或者设置为0，表示不做超时处理。</p></li>

<li><p>查询时，如果已经超过了设置的时间，则不再返回。</p></li>

<li><p>超时了的键值对，需要调用方法进行清理。</p></li>
</ul>

<hr />

<h1 id="功能实现">功能实现</h1>

<h3 id="map-并发安全问题">map 并发安全问题：</h3>

<p>在 go 语言中数据类型中的 map 并不是并发安全的，多次读读写写时会出现数据冲突问题。</p>

<p>然而在 go1.9 开始官方出现了 sync.Map 这个利器。</p>

<p>sync.Map 内部原理实现其实采用 lock free 利用两个数据结构 read （读写）和 dirty （删除）， 以及 CAS （原子操作比较替换），状态替换等。实现了较为高效的且为并发安全的 map。</p>

<p>所以本篇也是主要利用 sync.Map 进行键值存储设计。</p>

<h3 id="首先来看看数据结构的设计">首先来看看数据结构的设计</h3>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#859900">type</span> <span style="color:#268bd2">Item</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">Object</span>     <span style="color:#859900">interface</span>{}  <span style="color:#93a1a1;font-style:italic">// value具体的值数据
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">Expiration</span> <span style="color:#859900;font-weight:bold">int64</span>        <span style="color:#93a1a1;font-style:italic">// 超时时间戳
</span><span style="color:#93a1a1;font-style:italic"></span>}


<span style="color:#859900">type</span> <span style="color:#268bd2">Cache</span> <span style="color:#859900">struct</span> {
	*<span style="color:#268bd2">cache</span>
	<span style="color:#93a1a1;font-style:italic">// If this is confusing, see the comment at the bottom of New()
</span><span style="color:#93a1a1;font-style:italic"></span>}

<span style="color:#859900">type</span> <span style="color:#268bd2">janitor</span> <span style="color:#859900">struct</span> { <span style="color:#93a1a1;font-style:italic">// 用户组件的初始化启动停止
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">Interval</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>
	<span style="color:#268bd2">stop</span>     <span style="color:#859900">chan</span> <span style="color:#859900;font-weight:bold">bool</span>
}

<span style="color:#859900">type</span> <span style="color:#268bd2">cache</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">defaultExpiration</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span> <span style="color:#93a1a1;font-style:italic">// 默认超时时间设置
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">items</span>             <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>
	<span style="color:#268bd2">mu</span>                <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>
	<span style="color:#268bd2">ma</span>                <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">Map</span>
	<span style="color:#268bd2">onEvicted</span>         <span style="color:#859900">func</span>(<span style="color:#859900;font-weight:bold">string</span>, <span style="color:#859900">interface</span>{})
	<span style="color:#268bd2">janitor</span>           *<span style="color:#268bd2">janitor</span>
}</code></pre></div>
<h3 id="对于超时限制的处理">对于超时限制的处理：</h3>

<ul>
<li>Set时，建立超时字段存入即可，如下：</li>
</ul>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Set</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">x</span> <span style="color:#859900">interface</span>{}, <span style="color:#268bd2">d</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#859900">var</span> <span style="color:#268bd2">e</span> <span style="color:#859900;font-weight:bold">int64</span>
	<span style="color:#859900">if</span> <span style="color:#268bd2">d</span> == <span style="color:#268bd2">DefaultExpiration</span> {
		<span style="color:#268bd2">d</span> = <span style="color:#268bd2">c</span>.<span style="color:#268bd2">defaultExpiration</span>
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">d</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#268bd2">e</span> = <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">Add</span>(<span style="color:#268bd2">d</span>).<span style="color:#268bd2">UnixNano</span>() <span style="color:#93a1a1;font-style:italic">// 加入超时限制，取未来（传入的超时时间段）某一点的时间戳
</span><span style="color:#93a1a1;font-style:italic"></span>	}

	<span style="color:#268bd2">item</span> := <span style="color:#268bd2">Item</span>{
		<span style="color:#268bd2">Object</span>:     <span style="color:#268bd2">x</span>,
		<span style="color:#268bd2">Expiration</span>: <span style="color:#268bd2">e</span>,
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Store</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">item</span>) <span style="color:#93a1a1;font-style:italic">// 利用sync.map进行并发安全的存储
</span><span style="color:#93a1a1;font-style:italic"></span>}</code></pre></div>
<ul>
<li>Get 时进行函数内置的超时判断：</li>
</ul>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#93a1a1;font-style:italic">// Get an item from the cache. Returns the item or nil, and a bool indicating
</span><span style="color:#93a1a1;font-style:italic">// whether the key was found.
</span><span style="color:#93a1a1;font-style:italic">// 获取键值对应的值，内置判断是否超时
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Get</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) (<span style="color:#859900">interface</span>{}, <span style="color:#859900;font-weight:bold">bool</span>) {
	<span style="color:#268bd2">item</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>
	}

	<span style="color:#859900">if</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {   <span style="color:#93a1a1;font-style:italic">// 判断是否设置超时
</span><span style="color:#93a1a1;font-style:italic"></span>		<span style="color:#859900">if</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>() &gt; <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> {
			<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>         <span style="color:#93a1a1;font-style:italic">// 判断超时即返回nil
</span><span style="color:#93a1a1;font-style:italic"></span>		}
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Object</span>, <span style="color:#859900;font-weight:bold">true</span>
}</code></pre></div>
<h1 id="代码展示">代码展示</h1>

<p>相关代码如下：</p>

<blockquote>
<p>仅做参考，可自由摄取扩展等。如有雷同纯属借鉴~</p>
</blockquote>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#dc322f;font-weight:bold">package</span> <span style="color:#268bd2">cache</span>

<span style="color:#dc322f;font-weight:bold">import</span> (
	<span style="color:#2aa198">&#34;encoding/gob&#34;</span>
	<span style="color:#2aa198">&#34;fmt&#34;</span>
	<span style="color:#2aa198">&#34;io&#34;</span>
	<span style="color:#2aa198">&#34;os&#34;</span>
	<span style="color:#2aa198">&#34;runtime&#34;</span>
	<span style="color:#2aa198">&#34;sync&#34;</span>
	<span style="color:#2aa198">&#34;time&#34;</span>
)

<span style="color:#859900">type</span> <span style="color:#268bd2">Item</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">Object</span>     <span style="color:#859900">interface</span>{}
	<span style="color:#268bd2">Expiration</span> <span style="color:#859900;font-weight:bold">int64</span>
}

<span style="color:#93a1a1;font-style:italic">// Returns true if the item has expired.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">item</span> <span style="color:#268bd2">Item</span>) <span style="color:#268bd2">Expired</span>() <span style="color:#859900;font-weight:bold">bool</span> {
	<span style="color:#859900">if</span> <span style="color:#268bd2">item</span>.<span style="color:#268bd2">Expiration</span> == <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">false</span>
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>() &gt; <span style="color:#268bd2">item</span>.<span style="color:#268bd2">Expiration</span>
}

<span style="color:#859900">const</span> (
	<span style="color:#93a1a1;font-style:italic">// For use with functions that take an expiration time.
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">NoExpiration</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span> = -<span style="color:#2aa198;font-weight:bold">1</span>
	<span style="color:#93a1a1;font-style:italic">// For use with functions that take an expiration time. Equivalent to
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// passing in the same expiration duration as was given to New() or
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// NewFrom() when the cache was created (e.g. 5 minutes.)
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">DefaultExpiration</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span> = <span style="color:#2aa198;font-weight:bold">0</span>
)

<span style="color:#859900">type</span> <span style="color:#268bd2">Cache</span> <span style="color:#859900">struct</span> {
	*<span style="color:#268bd2">cache</span>
	<span style="color:#93a1a1;font-style:italic">// If this is confusing, see the comment at the bottom of New()
</span><span style="color:#93a1a1;font-style:italic"></span>}

<span style="color:#859900">type</span> <span style="color:#268bd2">cache</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">defaultExpiration</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>
	<span style="color:#268bd2">items</span>             <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>
	<span style="color:#268bd2">mu</span>                <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>
	<span style="color:#268bd2">ma</span>                <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">Map</span>
	<span style="color:#268bd2">onEvicted</span>         <span style="color:#859900">func</span>(<span style="color:#859900;font-weight:bold">string</span>, <span style="color:#859900">interface</span>{})
	<span style="color:#268bd2">janitor</span>           *<span style="color:#268bd2">janitor</span>
}

<span style="color:#93a1a1;font-style:italic">// Add an item to the cache, replacing any existing item. If the duration is 0
</span><span style="color:#93a1a1;font-style:italic">// (DefaultExpiration), the cache&#39;s default expiration time is used. If it is -1
</span><span style="color:#93a1a1;font-style:italic">// (NoExpiration), the item never expires.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Set</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">x</span> <span style="color:#859900">interface</span>{}, <span style="color:#268bd2">d</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#859900">var</span> <span style="color:#268bd2">e</span> <span style="color:#859900;font-weight:bold">int64</span>
	<span style="color:#859900">if</span> <span style="color:#268bd2">d</span> == <span style="color:#268bd2">DefaultExpiration</span> {
		<span style="color:#268bd2">d</span> = <span style="color:#268bd2">c</span>.<span style="color:#268bd2">defaultExpiration</span>
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">d</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#268bd2">e</span> = <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">Add</span>(<span style="color:#268bd2">d</span>).<span style="color:#268bd2">UnixNano</span>()
	}

	<span style="color:#268bd2">item</span> := <span style="color:#268bd2">Item</span>{
		<span style="color:#268bd2">Object</span>:     <span style="color:#268bd2">x</span>,
		<span style="color:#268bd2">Expiration</span>: <span style="color:#268bd2">e</span>,
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Store</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">item</span>)
}

<span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">set</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">x</span> <span style="color:#859900">interface</span>{}, <span style="color:#268bd2">d</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#859900">var</span> <span style="color:#268bd2">e</span> <span style="color:#859900;font-weight:bold">int64</span>
	<span style="color:#859900">if</span> <span style="color:#268bd2">d</span> == <span style="color:#268bd2">DefaultExpiration</span> {
		<span style="color:#268bd2">d</span> = <span style="color:#268bd2">c</span>.<span style="color:#268bd2">defaultExpiration</span>
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">d</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#268bd2">e</span> = <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">Add</span>(<span style="color:#268bd2">d</span>).<span style="color:#268bd2">UnixNano</span>()
	}

	<span style="color:#268bd2">item</span> := <span style="color:#268bd2">Item</span>{
		<span style="color:#268bd2">Object</span>:     <span style="color:#268bd2">x</span>,
		<span style="color:#268bd2">Expiration</span>: <span style="color:#268bd2">e</span>,
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Store</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">item</span>)
}

<span style="color:#93a1a1;font-style:italic">// Add an item to the cache, replacing any existing item, using the default
</span><span style="color:#93a1a1;font-style:italic">// expiration.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">SetDefault</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">x</span> <span style="color:#859900">interface</span>{}) {
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">Set</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">x</span>, <span style="color:#268bd2">DefaultExpiration</span>)
}

<span style="color:#93a1a1;font-style:italic">// Add an item to the cache only if an item doesn&#39;t already exist for the given
</span><span style="color:#93a1a1;font-style:italic">// key, or if the existing item has expired. Returns an error otherwise.
</span><span style="color:#93a1a1;font-style:italic">// 新增一个不存在的 键值对（判断是否存在该Key）
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Add</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">x</span> <span style="color:#859900">interface</span>{}, <span style="color:#268bd2">d</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">get</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#859900">return</span> <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Item %s already exists&#34;</span>, <span style="color:#268bd2">k</span>)
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">set</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">x</span>, <span style="color:#268bd2">d</span>)
	<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>
}

<span style="color:#93a1a1;font-style:italic">// Set a new value for the cache key only if it already exists, and the existing
</span><span style="color:#93a1a1;font-style:italic">// item hasn&#39;t expired. Returns an error otherwise.
</span><span style="color:#93a1a1;font-style:italic">// 替换 已经存在的 键的值
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Replace</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">x</span> <span style="color:#859900">interface</span>{}, <span style="color:#268bd2">d</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">get</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#859900">return</span> <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Item %s doesn&#39;t exist&#34;</span>, <span style="color:#268bd2">k</span>)
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">set</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">x</span>, <span style="color:#268bd2">d</span>)
	<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>
}

<span style="color:#93a1a1;font-style:italic">// Get an item from the cache. Returns the item or nil, and a bool indicating
</span><span style="color:#93a1a1;font-style:italic">// whether the key was found.
</span><span style="color:#93a1a1;font-style:italic">// 获取键值对应的值，内置判断是否超时
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Get</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) (<span style="color:#859900">interface</span>{}, <span style="color:#859900;font-weight:bold">bool</span>) {
	<span style="color:#268bd2">item</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>
	}

	<span style="color:#859900">if</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>() &gt; <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> {
			<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>
		}
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Object</span>, <span style="color:#859900;font-weight:bold">true</span>
}

<span style="color:#93a1a1;font-style:italic">// GetWithExpiration returns an item and its expiration time from the cache.
</span><span style="color:#93a1a1;font-style:italic">// It returns the item or nil, the expiration time if one is set (if the item
</span><span style="color:#93a1a1;font-style:italic">// never expires a zero value for time.Time is returned), and a bool indicating
</span><span style="color:#93a1a1;font-style:italic">// whether the key was found.
</span><span style="color:#93a1a1;font-style:italic">// 返回该键对应值，过期时间，是否存在 （不存在则不再返回超时时间和值）
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) (<span style="color:#859900">interface</span>{}, <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Time</span>, <span style="color:#859900;font-weight:bold">bool</span>) {
	<span style="color:#93a1a1;font-style:italic">// &#34;Inlining&#34; of get and Expired
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">item</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Time</span>{}, <span style="color:#859900;font-weight:bold">false</span>
	}

	<span style="color:#859900">if</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>() &gt; <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> {
			<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Time</span>{}, <span style="color:#859900;font-weight:bold">false</span>
		}

		<span style="color:#93a1a1;font-style:italic">// Return the item and the expiration time
</span><span style="color:#93a1a1;font-style:italic"></span>		<span style="color:#859900">return</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Object</span>, <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Unix</span>(<span style="color:#2aa198;font-weight:bold">0</span>, <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span>), <span style="color:#859900;font-weight:bold">true</span>
	}

	<span style="color:#93a1a1;font-style:italic">// If expiration &lt;= 0 (i.e. no expiration time set) then return the item
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// and a zeroed time.Time
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#859900">return</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Object</span>, <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Time</span>{}, <span style="color:#859900;font-weight:bold">true</span>
}

<span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">get</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) (<span style="color:#859900">interface</span>{}, <span style="color:#859900;font-weight:bold">bool</span>) {
	<span style="color:#268bd2">item</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#93a1a1;font-style:italic">//item, found := c.items[k]
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>
	}

	<span style="color:#93a1a1;font-style:italic">// &#34;Inlining&#34; of Expired
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#859900">if</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>() &gt; <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> {
			<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>
		}
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">item</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Object</span>, <span style="color:#859900;font-weight:bold">true</span>
}

<span style="color:#93a1a1;font-style:italic">// Increment an item of type int, int8, int16, int32, int64, uintptr, uint,
</span><span style="color:#93a1a1;font-style:italic">// uint8, uint32, or uint64, float32 or float64 by n. Returns an error if the
</span><span style="color:#93a1a1;font-style:italic">// item&#39;s value is not an integer, if it was not found, or if it is not
</span><span style="color:#93a1a1;font-style:italic">// possible to increment it by n. To retrieve the incremented value, use one
</span><span style="color:#93a1a1;font-style:italic">// of the specialized methods, e.g. IncrementInt64.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Increment</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">n</span> <span style="color:#859900;font-weight:bold">int64</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
	<span style="color:#268bd2">v</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>[<span style="color:#268bd2">k</span>]
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> || <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Expired</span>() {
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
		<span style="color:#859900">return</span> <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Item %s not found&#34;</span>, <span style="color:#268bd2">k</span>)
	}
	<span style="color:#859900">switch</span> <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900">type</span>) {
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int</span>) + <span style="color:#cb4b16">int</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int8</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int8</span>) + <span style="color:#cb4b16">int8</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int16</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int16</span>) + <span style="color:#cb4b16">int16</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int32</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int32</span>) + <span style="color:#cb4b16">int32</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int64</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int64</span>) + <span style="color:#268bd2">n</span>
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint</span>) + <span style="color:#cb4b16">uint</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uintptr</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uintptr</span>) + <span style="color:#cb4b16">uintptr</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint8</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint8</span>) + <span style="color:#cb4b16">uint8</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint16</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint16</span>) + <span style="color:#cb4b16">uint16</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint32</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint32</span>) + <span style="color:#cb4b16">uint32</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint64</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint64</span>) + <span style="color:#cb4b16">uint64</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">float32</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">float32</span>) + <span style="color:#cb4b16">float32</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">float64</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">float64</span>) + <span style="color:#cb4b16">float64</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">default</span>:
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
		<span style="color:#859900">return</span> <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;The value for %s is not an integer&#34;</span>, <span style="color:#268bd2">k</span>)
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>[<span style="color:#268bd2">k</span>] = <span style="color:#268bd2">v</span>
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>
}

<span style="color:#93a1a1;font-style:italic">// Decrement an item of type int, int8, int16, int32, int64, uintptr, uint,
</span><span style="color:#93a1a1;font-style:italic">// uint8, uint32, or uint64, float32 or float64 by n. Returns an error if the
</span><span style="color:#93a1a1;font-style:italic">// item&#39;s value is not an integer, if it was not found, or if it is not
</span><span style="color:#93a1a1;font-style:italic">// possible to decrement it by n. To retrieve the decremented value, use one
</span><span style="color:#93a1a1;font-style:italic">// of the specialized methods, e.g. DecrementInt64.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Decrement</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">n</span> <span style="color:#859900;font-weight:bold">int64</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#93a1a1;font-style:italic">// TODO: Implement Increment and Decrement more cleanly.
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// (Cannot do Increment(k, n*-1) for uints.)
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
	<span style="color:#268bd2">v</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>[<span style="color:#268bd2">k</span>]
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> || <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Expired</span>() {
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
		<span style="color:#859900">return</span> <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Item not found&#34;</span>)
	}
	<span style="color:#859900">switch</span> <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900">type</span>) {
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int</span>) - <span style="color:#cb4b16">int</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int8</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int8</span>) - <span style="color:#cb4b16">int8</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int16</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int16</span>) - <span style="color:#cb4b16">int16</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int32</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int32</span>) - <span style="color:#cb4b16">int32</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">int64</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">int64</span>) - <span style="color:#268bd2">n</span>
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint</span>) - <span style="color:#cb4b16">uint</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uintptr</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uintptr</span>) - <span style="color:#cb4b16">uintptr</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint8</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint8</span>) - <span style="color:#cb4b16">uint8</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint16</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint16</span>) - <span style="color:#cb4b16">uint16</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint32</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint32</span>) - <span style="color:#cb4b16">uint32</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">uint64</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">uint64</span>) - <span style="color:#cb4b16">uint64</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">float32</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">float32</span>) - <span style="color:#cb4b16">float32</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">case</span> <span style="color:#859900;font-weight:bold">float64</span>:
		<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span> = <span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>.(<span style="color:#859900;font-weight:bold">float64</span>) - <span style="color:#cb4b16">float64</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">default</span>:
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
		<span style="color:#859900">return</span> <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;The value for %s is not an integer&#34;</span>, <span style="color:#268bd2">k</span>)
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>[<span style="color:#268bd2">k</span>] = <span style="color:#268bd2">v</span>
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>
}

<span style="color:#93a1a1;font-style:italic">// Delete an item from the cache. Does nothing if the key is not in the cache.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Delete</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) {
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
	<span style="color:#268bd2">v</span>, <span style="color:#268bd2">evicted</span> := <span style="color:#268bd2">c</span>.<span style="color:#cb4b16">delete</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	<span style="color:#859900">if</span> <span style="color:#268bd2">evicted</span> {
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">onEvicted</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">v</span>) <span style="color:#93a1a1;font-style:italic">// 给入具体参数，开始调用  func(string, interface{})
</span><span style="color:#93a1a1;font-style:italic"></span>	}
}

<span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#cb4b16">delete</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) (<span style="color:#859900">interface</span>{}, <span style="color:#859900;font-weight:bold">bool</span>) {
	<span style="color:#859900">if</span> <span style="color:#268bd2">c</span>.<span style="color:#268bd2">onEvicted</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">v</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">k</span>); <span style="color:#268bd2">found</span> {
			<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Delete</span>(<span style="color:#268bd2">k</span>)
			<span style="color:#859900">return</span> <span style="color:#268bd2">v</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Object</span>, <span style="color:#859900;font-weight:bold">true</span>
		}
	}

	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Delete</span>(<span style="color:#268bd2">k</span>)
	<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>, <span style="color:#859900;font-weight:bold">false</span>
}

<span style="color:#859900">type</span> <span style="color:#268bd2">keyAndValue</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">key</span>   <span style="color:#859900;font-weight:bold">string</span>
	<span style="color:#268bd2">value</span> <span style="color:#859900">interface</span>{}
}

<span style="color:#93a1a1;font-style:italic">// Delete all expired items from the cache.
</span><span style="color:#93a1a1;font-style:italic">// 删除所有 超时的 键值
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">DeleteExpired</span>() {
	<span style="color:#859900">var</span> <span style="color:#268bd2">evictedItems</span> []<span style="color:#268bd2">keyAndValue</span>
	<span style="color:#268bd2">now</span> := <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>()
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Range</span>(<span style="color:#859900">func</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">v</span> <span style="color:#859900">interface</span>{}) <span style="color:#859900;font-weight:bold">bool</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">v</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> &amp;&amp; <span style="color:#268bd2">now</span> &gt; <span style="color:#268bd2">v</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> {
			<span style="color:#268bd2">ov</span>, <span style="color:#268bd2">evicted</span> := <span style="color:#268bd2">c</span>.<span style="color:#cb4b16">delete</span>(<span style="color:#268bd2">k</span>.(<span style="color:#859900;font-weight:bold">string</span>))
			<span style="color:#859900">if</span> <span style="color:#268bd2">evicted</span> {
				<span style="color:#268bd2">evictedItems</span> = <span style="color:#cb4b16">append</span>(<span style="color:#268bd2">evictedItems</span>, <span style="color:#268bd2">keyAndValue</span>{<span style="color:#268bd2">k</span>.(<span style="color:#859900;font-weight:bold">string</span>), <span style="color:#268bd2">ov</span>})
			}
		}
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">true</span>
	})

	<span style="color:#859900">for</span> <span style="color:#268bd2">_</span>, <span style="color:#268bd2">v</span> := <span style="color:#859900">range</span> <span style="color:#268bd2">evictedItems</span> {
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">onEvicted</span>(<span style="color:#268bd2">v</span>.<span style="color:#268bd2">key</span>, <span style="color:#268bd2">v</span>.<span style="color:#268bd2">value</span>)
	}
}

<span style="color:#93a1a1;font-style:italic">// Sets an (optional) function that is called with the key and value when an
</span><span style="color:#93a1a1;font-style:italic">// item is evicted from the cache. (Including when it is deleted manually, but
</span><span style="color:#93a1a1;font-style:italic">// not when it is overwritten.) Set to nil to disable.
</span><span style="color:#93a1a1;font-style:italic">// 删除 键值对后 做一些回调事件
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">OnEvicted</span>(<span style="color:#268bd2">f</span> <span style="color:#859900">func</span>(<span style="color:#859900;font-weight:bold">string</span>, <span style="color:#859900">interface</span>{})) {
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">onEvicted</span> = <span style="color:#268bd2">f</span>
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
}

<span style="color:#93a1a1;font-style:italic">// Write the cache&#39;s items (using Gob) to an io.Writer.
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// NOTE: This method is deprecated in favor of c.Items() and NewFrom() (see the
</span><span style="color:#93a1a1;font-style:italic">// documentation for NewFrom().)
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Save</span>(<span style="color:#268bd2">w</span> <span style="color:#268bd2">io</span>.<span style="color:#268bd2">Writer</span>) (<span style="color:#268bd2">err</span> <span style="color:#859900;font-weight:bold">error</span>) {
	<span style="color:#268bd2">enc</span> := <span style="color:#268bd2">gob</span>.<span style="color:#268bd2">NewEncoder</span>(<span style="color:#268bd2">w</span>)
	<span style="color:#859900">defer</span> <span style="color:#859900">func</span>() {
		<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> := <span style="color:#cb4b16">recover</span>(); <span style="color:#268bd2">x</span> != <span style="color:#859900;font-weight:bold">nil</span> {
			<span style="color:#268bd2">err</span> = <span style="color:#268bd2">fmt</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Error registering item types with Gob library&#34;</span>)
		}
	}()
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RLock</span>()
	<span style="color:#859900">defer</span> <span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RUnlock</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">_</span>, <span style="color:#268bd2">v</span> := <span style="color:#859900">range</span> <span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span> {
		<span style="color:#268bd2">gob</span>.<span style="color:#268bd2">Register</span>(<span style="color:#268bd2">v</span>.<span style="color:#268bd2">Object</span>)
	}
	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">enc</span>.<span style="color:#268bd2">Encode</span>(&amp;<span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>)
	<span style="color:#859900">return</span>
}

<span style="color:#93a1a1;font-style:italic">// Save the cache&#39;s items to the given filename, creating the file if it
</span><span style="color:#93a1a1;font-style:italic">// doesn&#39;t exist, and overwriting it if it does.
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// NOTE: This method is deprecated in favor of c.Items() and NewFrom() (see the
</span><span style="color:#93a1a1;font-style:italic">// documentation for NewFrom().)
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">SaveFile</span>(<span style="color:#268bd2">fname</span> <span style="color:#859900;font-weight:bold">string</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#268bd2">fp</span>, <span style="color:#268bd2">err</span> := <span style="color:#268bd2">os</span>.<span style="color:#268bd2">Create</span>(<span style="color:#268bd2">fname</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#859900">return</span> <span style="color:#268bd2">err</span>
	}
	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">c</span>.<span style="color:#268bd2">Save</span>(<span style="color:#268bd2">fp</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">fp</span>.<span style="color:#268bd2">Close</span>()
		<span style="color:#859900">return</span> <span style="color:#268bd2">err</span>
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">fp</span>.<span style="color:#268bd2">Close</span>()
}

<span style="color:#93a1a1;font-style:italic">// Add (Gob-serialized) cache items from an io.Reader, excluding any items with
</span><span style="color:#93a1a1;font-style:italic">// keys that already exist (and haven&#39;t expired) in the current cache.
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// NOTE: This method is deprecated in favor of c.Items() and NewFrom() (see the
</span><span style="color:#93a1a1;font-style:italic">// documentation for NewFrom().)
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Load</span>(<span style="color:#268bd2">r</span> <span style="color:#268bd2">io</span>.<span style="color:#268bd2">Reader</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#268bd2">dec</span> := <span style="color:#268bd2">gob</span>.<span style="color:#268bd2">NewDecoder</span>(<span style="color:#268bd2">r</span>)
	<span style="color:#268bd2">items</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>{}
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">dec</span>.<span style="color:#268bd2">Decode</span>(&amp;<span style="color:#268bd2">items</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
		<span style="color:#859900">defer</span> <span style="color:#268bd2">c</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
		<span style="color:#859900">for</span> <span style="color:#268bd2">k</span>, <span style="color:#268bd2">v</span> := <span style="color:#859900">range</span> <span style="color:#268bd2">items</span> {
			<span style="color:#268bd2">ov</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>[<span style="color:#268bd2">k</span>]
			<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> || <span style="color:#268bd2">ov</span>.<span style="color:#268bd2">Expired</span>() {
				<span style="color:#268bd2">c</span>.<span style="color:#268bd2">items</span>[<span style="color:#268bd2">k</span>] = <span style="color:#268bd2">v</span>
			}
		}
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">err</span>
}

<span style="color:#93a1a1;font-style:italic">// Load and add cache items from the given filename, excluding any items with
</span><span style="color:#93a1a1;font-style:italic">// keys that already exist in the current cache.
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// NOTE: This method is deprecated in favor of c.Items() and NewFrom() (see the
</span><span style="color:#93a1a1;font-style:italic">// documentation for NewFrom().)
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">LoadFile</span>(<span style="color:#268bd2">fname</span> <span style="color:#859900;font-weight:bold">string</span>) <span style="color:#859900;font-weight:bold">error</span> {
	<span style="color:#268bd2">fp</span>, <span style="color:#268bd2">err</span> := <span style="color:#268bd2">os</span>.<span style="color:#268bd2">Open</span>(<span style="color:#268bd2">fname</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#859900">return</span> <span style="color:#268bd2">err</span>
	}
	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">c</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">fp</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">fp</span>.<span style="color:#268bd2">Close</span>()
		<span style="color:#859900">return</span> <span style="color:#268bd2">err</span>
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">fp</span>.<span style="color:#268bd2">Close</span>()
}

<span style="color:#93a1a1;font-style:italic">// Copies all unexpired items in the cache into a new map and returns it.
</span><span style="color:#93a1a1;font-style:italic">// 返回所有未超时的 副本键值
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Items</span>() <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span> {
	<span style="color:#268bd2">m</span> := <span style="color:#cb4b16">make</span>(<span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>, <span style="color:#268bd2">c</span>.<span style="color:#268bd2">ItemCount</span>())
	<span style="color:#268bd2">now</span> := <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>()
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Range</span>(<span style="color:#859900">func</span>(<span style="color:#268bd2">key</span>, <span style="color:#268bd2">v</span> <span style="color:#859900">interface</span>{}) <span style="color:#859900;font-weight:bold">bool</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">v</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
			<span style="color:#859900">if</span> <span style="color:#268bd2">now</span> &lt;= <span style="color:#268bd2">v</span>.(<span style="color:#268bd2">Item</span>).<span style="color:#268bd2">Expiration</span> {
				<span style="color:#268bd2">m</span>[<span style="color:#268bd2">key</span>.(<span style="color:#859900;font-weight:bold">string</span>)] = <span style="color:#268bd2">v</span>.(<span style="color:#268bd2">Item</span>)
			}
		}
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">true</span>
	})
	<span style="color:#859900">return</span> <span style="color:#268bd2">m</span>
}

<span style="color:#93a1a1;font-style:italic">// Returns the number of items in the cache. This may include items that have
</span><span style="color:#93a1a1;font-style:italic">// expired, but have not yet been cleaned up.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">ItemCount</span>() <span style="color:#859900;font-weight:bold">int</span> {
	<span style="color:#268bd2">count</span> := <span style="color:#2aa198;font-weight:bold">0</span>
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Range</span>(<span style="color:#859900">func</span>(<span style="color:#268bd2">key</span>, <span style="color:#268bd2">_</span> <span style="color:#859900">interface</span>{}) <span style="color:#859900;font-weight:bold">bool</span> {
		<span style="color:#268bd2">count</span>++
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">true</span>
	})
	<span style="color:#859900">return</span> <span style="color:#268bd2">count</span>
}

<span style="color:#93a1a1;font-style:italic">// Delete all items from the cache.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) <span style="color:#268bd2">Flush</span>() {
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Range</span>(<span style="color:#859900">func</span>(<span style="color:#268bd2">k</span>, <span style="color:#268bd2">_</span> <span style="color:#859900">interface</span>{}) <span style="color:#859900;font-weight:bold">bool</span> {
		<span style="color:#268bd2">c</span>.<span style="color:#268bd2">ma</span>.<span style="color:#268bd2">Delete</span>(<span style="color:#268bd2">k</span>)
		<span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">true</span>
	})
}

<span style="color:#859900">type</span> <span style="color:#268bd2">janitor</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">Interval</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>
	<span style="color:#268bd2">stop</span>     <span style="color:#859900">chan</span> <span style="color:#859900;font-weight:bold">bool</span>
}

<span style="color:#93a1a1;font-style:italic">// 关于如何初始化并启动该组件函数：
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> (<span style="color:#268bd2">j</span> *<span style="color:#268bd2">janitor</span>) <span style="color:#268bd2">Run</span>(<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>) {
	<span style="color:#268bd2">ticker</span> := <span style="color:#268bd2">time</span>.<span style="color:#268bd2">NewTicker</span>(<span style="color:#268bd2">j</span>.<span style="color:#268bd2">Interval</span>)
	<span style="color:#859900">for</span> {
		<span style="color:#859900">select</span> {
		<span style="color:#859900">case</span> &lt;-<span style="color:#268bd2">ticker</span>.<span style="color:#268bd2">C</span>:
			<span style="color:#268bd2">c</span>.<span style="color:#268bd2">DeleteExpired</span>()
		<span style="color:#859900">case</span> &lt;-<span style="color:#268bd2">j</span>.<span style="color:#268bd2">stop</span>:
			<span style="color:#268bd2">ticker</span>.<span style="color:#268bd2">Stop</span>()
			<span style="color:#859900">return</span>
		}
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">stopJanitor</span>(<span style="color:#268bd2">c</span> *<span style="color:#268bd2">Cache</span>) {
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">janitor</span>.<span style="color:#268bd2">stop</span> &lt;- <span style="color:#859900;font-weight:bold">true</span>
}

<span style="color:#859900">func</span> <span style="color:#268bd2">runJanitor</span>(<span style="color:#268bd2">c</span> *<span style="color:#268bd2">cache</span>, <span style="color:#268bd2">ci</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#268bd2">j</span> := &amp;<span style="color:#268bd2">janitor</span>{
		<span style="color:#268bd2">Interval</span>: <span style="color:#268bd2">ci</span>,
		<span style="color:#268bd2">stop</span>:     <span style="color:#cb4b16">make</span>(<span style="color:#859900">chan</span> <span style="color:#859900;font-weight:bold">bool</span>),
	}
	<span style="color:#268bd2">c</span>.<span style="color:#268bd2">janitor</span> = <span style="color:#268bd2">j</span>
	<span style="color:#859900">go</span> <span style="color:#268bd2">j</span>.<span style="color:#268bd2">Run</span>(<span style="color:#268bd2">c</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">newCache</span>(<span style="color:#268bd2">de</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>, <span style="color:#268bd2">m</span> <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>) *<span style="color:#268bd2">cache</span> {
	<span style="color:#859900">if</span> <span style="color:#268bd2">de</span> == <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#268bd2">de</span> = -<span style="color:#2aa198;font-weight:bold">1</span>
	}
	<span style="color:#268bd2">c</span> := &amp;<span style="color:#268bd2">cache</span>{
		<span style="color:#268bd2">defaultExpiration</span>: <span style="color:#268bd2">de</span>,
		<span style="color:#268bd2">items</span>:             <span style="color:#268bd2">m</span>,
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">c</span>
}

<span style="color:#859900">func</span> <span style="color:#268bd2">newCacheWithJanitor</span>(<span style="color:#268bd2">de</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>, <span style="color:#268bd2">ci</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>, <span style="color:#268bd2">m</span> <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>) *<span style="color:#268bd2">Cache</span> {
	<span style="color:#268bd2">c</span> := <span style="color:#268bd2">newCache</span>(<span style="color:#268bd2">de</span>, <span style="color:#268bd2">m</span>)
	<span style="color:#93a1a1;font-style:italic">// This trick ensures that the janitor goroutine (which--granted it
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// was enabled--is running DeleteExpired on c forever) does not keep
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// the returned C object from being garbage collected. When it is
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// garbage collected, the finalizer stops the janitor goroutine, after
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// which c can be collected.
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">C</span> := &amp;<span style="color:#268bd2">Cache</span>{<span style="color:#268bd2">c</span>}
	<span style="color:#859900">if</span> <span style="color:#268bd2">ci</span> &gt; <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#268bd2">runJanitor</span>(<span style="color:#268bd2">c</span>, <span style="color:#268bd2">ci</span>)
		<span style="color:#268bd2">runtime</span>.<span style="color:#268bd2">SetFinalizer</span>(<span style="color:#268bd2">C</span>, <span style="color:#268bd2">stopJanitor</span>)
	}
	<span style="color:#859900">return</span> <span style="color:#268bd2">C</span>
}

<span style="color:#93a1a1;font-style:italic">// Return a new cache with a given default expiration duration and cleanup
</span><span style="color:#93a1a1;font-style:italic">// interval. If the expiration duration is less than one (or NoExpiration),
</span><span style="color:#93a1a1;font-style:italic">// the items in the cache never expire (by default), and must be deleted
</span><span style="color:#93a1a1;font-style:italic">// manually. If the cleanup interval is less than one, expired items are not
</span><span style="color:#93a1a1;font-style:italic">// deleted from the cache before calling c.DeleteExpired().
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> <span style="color:#268bd2">New</span>(<span style="color:#268bd2">defaultExpiration</span>, <span style="color:#268bd2">cleanupInterval</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) *<span style="color:#268bd2">Cache</span> {
	<span style="color:#268bd2">items</span> := <span style="color:#cb4b16">make</span>(<span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>)
	<span style="color:#859900">return</span> <span style="color:#268bd2">newCacheWithJanitor</span>(<span style="color:#268bd2">defaultExpiration</span>, <span style="color:#268bd2">cleanupInterval</span>, <span style="color:#268bd2">items</span>)
}

<span style="color:#93a1a1;font-style:italic">// Return a new cache with a given default expiration duration and cleanup
</span><span style="color:#93a1a1;font-style:italic">// interval. If the expiration duration is less than one (or NoExpiration),
</span><span style="color:#93a1a1;font-style:italic">// the items in the cache never expire (by default), and must be deleted
</span><span style="color:#93a1a1;font-style:italic">// manually. If the cleanup interval is less than one, expired items are not
</span><span style="color:#93a1a1;font-style:italic">// deleted from the cache before calling c.DeleteExpired().
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// NewFrom() also accepts an items map which will serve as the underlying map
</span><span style="color:#93a1a1;font-style:italic">// for the cache. This is useful for starting from a deserialized cache
</span><span style="color:#93a1a1;font-style:italic">// (serialized using e.g. gob.Encode() on c.Items()), or passing in e.g.
</span><span style="color:#93a1a1;font-style:italic">// make(map[string]Item, 500) to improve startup performance when the cache
</span><span style="color:#93a1a1;font-style:italic">// is expected to reach a certain minimum size.
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// Only the cache&#39;s methods synchronize access to this map, so it is not
</span><span style="color:#93a1a1;font-style:italic">// recommended to keep any references to the map around after creating a cache.
</span><span style="color:#93a1a1;font-style:italic">// If need be, the map can be accessed at a later point using c.Items() (subject
</span><span style="color:#93a1a1;font-style:italic">// to the same caveat.)
</span><span style="color:#93a1a1;font-style:italic">//
</span><span style="color:#93a1a1;font-style:italic">// Note regarding serialization: When using e.g. gob, make sure to
</span><span style="color:#93a1a1;font-style:italic">// gob.Register() the individual types stored in the cache before encoding a
</span><span style="color:#93a1a1;font-style:italic">// map retrieved with c.Items(), and to register those same types before
</span><span style="color:#93a1a1;font-style:italic">// decoding a blob containing an items map.
</span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#859900">func</span> <span style="color:#268bd2">NewFrom</span>(<span style="color:#268bd2">defaultExpiration</span>, <span style="color:#268bd2">cleanupInterval</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>, <span style="color:#268bd2">items</span> <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>) *<span style="color:#268bd2">Cache</span> {
	<span style="color:#859900">return</span> <span style="color:#268bd2">newCacheWithJanitor</span>(<span style="color:#268bd2">defaultExpiration</span>, <span style="color:#268bd2">cleanupInterval</span>, <span style="color:#268bd2">items</span>)
}</code></pre></div>
<p>测试代码：</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#dc322f;font-weight:bold">package</span> <span style="color:#268bd2">cache</span>

<span style="color:#dc322f;font-weight:bold">import</span> (
	<span style="color:#2aa198">&#34;bytes&#34;</span>
	<span style="color:#2aa198">&#34;io/ioutil&#34;</span>
	<span style="color:#2aa198">&#34;runtime&#34;</span>
	<span style="color:#2aa198">&#34;strconv&#34;</span>
	<span style="color:#2aa198">&#34;sync&#34;</span>
	<span style="color:#2aa198">&#34;testing&#34;</span>
	<span style="color:#2aa198">&#34;time&#34;</span>
)

<span style="color:#859900">type</span> <span style="color:#268bd2">TestStruct</span> <span style="color:#859900">struct</span> {
	<span style="color:#268bd2">Num</span>      <span style="color:#859900;font-weight:bold">int</span>
	<span style="color:#268bd2">Children</span> []*<span style="color:#268bd2">TestStruct</span>
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestCache</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)

	<span style="color:#268bd2">a</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> || <span style="color:#268bd2">a</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Getting A found value that shouldn&#39;t exist:&#34;</span>, <span style="color:#268bd2">a</span>)
	}

	<span style="color:#268bd2">b</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> || <span style="color:#268bd2">b</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Getting B found value that shouldn&#39;t exist:&#34;</span>, <span style="color:#268bd2">b</span>)
	}

	<span style="color:#268bd2">c</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;c&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> || <span style="color:#268bd2">c</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Getting C found value that shouldn&#39;t exist:&#34;</span>, <span style="color:#268bd2">c</span>)
	}

	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;c&#34;</span>, <span style="color:#2aa198;font-weight:bold">3.5</span>, <span style="color:#268bd2">DefaultExpiration</span>)

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a was not found while getting a2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for a is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">a2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>); <span style="color:#268bd2">a2</span>+<span style="color:#2aa198;font-weight:bold">2</span> != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a2 (which should be 1) plus 2 does not equal 3; value:&#34;</span>, <span style="color:#268bd2">a2</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b was not found while getting b2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for b is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">b2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">string</span>); <span style="color:#268bd2">b2</span>+<span style="color:#2aa198">&#34;B&#34;</span> != <span style="color:#2aa198">&#34;bB&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b2 (which should be b) plus B does not equal bB; value:&#34;</span>, <span style="color:#268bd2">b2</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;c&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;c was not found while getting c2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for c is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">c2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">float64</span>); <span style="color:#268bd2">c2</span>+<span style="color:#2aa198;font-weight:bold">1.2</span> != <span style="color:#2aa198;font-weight:bold">4.7</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;c2 (which should be 3.5) plus 1.2 does not equal 4.7; value:&#34;</span>, <span style="color:#268bd2">c2</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestCacheTimes</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#859900">var</span> <span style="color:#268bd2">found</span> <span style="color:#859900;font-weight:bold">bool</span>

	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#2aa198;font-weight:bold">50</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>, <span style="color:#2aa198;font-weight:bold">1</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>, <span style="color:#268bd2">NoExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;c&#34;</span>, <span style="color:#2aa198;font-weight:bold">3</span>, <span style="color:#2aa198;font-weight:bold">20</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;d&#34;</span>, <span style="color:#2aa198;font-weight:bold">4</span>, <span style="color:#2aa198;font-weight:bold">70</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)

	&lt;-<span style="color:#268bd2">time</span>.<span style="color:#268bd2">After</span>(<span style="color:#2aa198;font-weight:bold">25</span> * <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;c&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Found c when it should have been automatically deleted&#34;</span>)
	}

	&lt;-<span style="color:#268bd2">time</span>.<span style="color:#268bd2">After</span>(<span style="color:#2aa198;font-weight:bold">30</span> * <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Found a when it should have been automatically deleted&#34;</span>)
	}

	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Did not find b even though it was set to never expire&#34;</span>)
	}

	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;d&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Did not find d even though it was set to expire later than the default&#34;</span>)
	}

	&lt;-<span style="color:#268bd2">time</span>.<span style="color:#268bd2">After</span>(<span style="color:#2aa198;font-weight:bold">20</span> * <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;d&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Found d when it should have been automatically deleted (later than the default)&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestNewFrom</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#268bd2">Item</span>{
		<span style="color:#2aa198">&#34;a&#34;</span>: <span style="color:#268bd2">Item</span>{
			<span style="color:#268bd2">Object</span>:     <span style="color:#2aa198;font-weight:bold">1</span>,
			<span style="color:#268bd2">Expiration</span>: <span style="color:#2aa198;font-weight:bold">0</span>,
		},
		<span style="color:#2aa198">&#34;b&#34;</span>: <span style="color:#268bd2">Item</span>{
			<span style="color:#268bd2">Object</span>:     <span style="color:#2aa198;font-weight:bold">2</span>,
			<span style="color:#268bd2">Expiration</span>: <span style="color:#2aa198;font-weight:bold">0</span>,
		},
	}
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">NewFrom</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>, <span style="color:#268bd2">m</span>)
	<span style="color:#268bd2">a</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;Did not find a&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">a</span>.(<span style="color:#859900;font-weight:bold">int</span>) != <span style="color:#2aa198;font-weight:bold">1</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;a is not 1&#34;</span>)
	}
	<span style="color:#268bd2">b</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;Did not find b&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">b</span>.(<span style="color:#859900;font-weight:bold">int</span>) != <span style="color:#2aa198;font-weight:bold">2</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;b is not 2&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestStorePointerToStruct</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, &amp;<span style="color:#268bd2">TestStruct</span>{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">1</span>}, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;*TestStruct was not found for foo&#34;</span>)
	}
	<span style="color:#268bd2">foo</span> := <span style="color:#268bd2">x</span>.(*<span style="color:#268bd2">TestStruct</span>)
	<span style="color:#268bd2">foo</span>.<span style="color:#268bd2">Num</span>++

	<span style="color:#268bd2">y</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;*TestStruct was not found for foo (second time)&#34;</span>)
	}
	<span style="color:#268bd2">bar</span> := <span style="color:#268bd2">y</span>.(*<span style="color:#268bd2">TestStruct</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">bar</span>.<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">2</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;TestStruct.Num is not 2&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithInt</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tint&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tint&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tint&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithInt8</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tint8&#34;</span>, <span style="color:#cb4b16">int8</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tint8&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tint8&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint8 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int8</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint8 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithInt16</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tint16&#34;</span>, <span style="color:#cb4b16">int16</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tint16&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tint16&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint16 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int16</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint16 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithInt32</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tint32&#34;</span>, <span style="color:#cb4b16">int32</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tint32&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tint32&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint32 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int32</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint32 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithInt64</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tint64&#34;</span>, <span style="color:#cb4b16">int64</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tint64&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tint64&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint64 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int64</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tint64 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithUint</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tuint&#34;</span>, <span style="color:#cb4b16">uint</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tuint&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tuint&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithUintptr</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tuintptr&#34;</span>, <span style="color:#cb4b16">uintptr</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tuintptr&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tuintptr&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuintptr was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uintptr</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuintptr is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithUint8</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tuint8&#34;</span>, <span style="color:#cb4b16">uint8</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tuint8&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tuint8&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint8 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint8</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint8 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithUint16</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tuint16&#34;</span>, <span style="color:#cb4b16">uint16</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tuint16&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tuint16&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint16 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint16</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint16 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithUint32</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tuint32&#34;</span>, <span style="color:#cb4b16">uint32</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tuint32&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tuint32&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint32 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint32</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint32 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithUint64</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;tuint64&#34;</span>, <span style="color:#cb4b16">uint64</span>(<span style="color:#2aa198;font-weight:bold">1</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;tuint64&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;tuint64&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint64 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint64</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;tuint64 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithFloat32</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;float32&#34;</span>, <span style="color:#cb4b16">float32</span>(<span style="color:#2aa198;font-weight:bold">1.5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;float32&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;float32&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float32 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">float32</span>) != <span style="color:#2aa198;font-weight:bold">3.5</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float32 is not 3.5:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementWithFloat64</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;float64&#34;</span>, <span style="color:#cb4b16">float64</span>(<span style="color:#2aa198;font-weight:bold">1.5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;float64&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;float64&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float64 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">float64</span>) != <span style="color:#2aa198;font-weight:bold">3.5</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float64 is not 3.5:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithInt</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;int&#34;</span>, <span style="color:#cb4b16">int</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;int&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;int&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithInt8</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;int8&#34;</span>, <span style="color:#cb4b16">int8</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;int8&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;int8&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int8 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int8</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int8 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithInt16</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;int16&#34;</span>, <span style="color:#cb4b16">int16</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;int16&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;int16&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int16 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int16</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int16 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithInt32</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;int32&#34;</span>, <span style="color:#cb4b16">int32</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;int32&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;int32&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int32 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int32</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int32 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithInt64</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;int64&#34;</span>, <span style="color:#cb4b16">int64</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;int64&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;int64&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int64 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int64</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int64 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithUint</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint&#34;</span>, <span style="color:#cb4b16">uint</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uint&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithUintptr</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uintptr&#34;</span>, <span style="color:#cb4b16">uintptr</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uintptr&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uintptr&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uintptr was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uintptr</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uintptr is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithUint8</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>, <span style="color:#cb4b16">uint8</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint8 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint8</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint8 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithUint16</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint16&#34;</span>, <span style="color:#cb4b16">uint16</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uint16&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint16&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint16 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint16</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint16 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithUint32</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint32&#34;</span>, <span style="color:#cb4b16">uint32</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uint32&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint32&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint32 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint32</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint32 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithUint64</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint64&#34;</span>, <span style="color:#cb4b16">uint64</span>(<span style="color:#2aa198;font-weight:bold">5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uint64&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint64&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint64 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint64</span>) != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint64 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithFloat32</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;float32&#34;</span>, <span style="color:#cb4b16">float32</span>(<span style="color:#2aa198;font-weight:bold">5.5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;float32&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;float32&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float32 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">float32</span>) != <span style="color:#2aa198;font-weight:bold">3.5</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float32 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementWithFloat64</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;float64&#34;</span>, <span style="color:#cb4b16">float64</span>(<span style="color:#2aa198;font-weight:bold">5.5</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;float64&#34;</span>, <span style="color:#2aa198;font-weight:bold">2</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;float64&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float64 was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">float64</span>) != <span style="color:#2aa198;font-weight:bold">3.5</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;float64 is not 3:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestAdd</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Add</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Couldn&#39;t add foo even though it shouldn&#39;t exist&#34;</span>)
	}
	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Add</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;baz&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Successfully added another foo when it should have returned an error&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestReplace</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Replace</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Replaced foo when it shouldn&#39;t exist&#34;</span>)
	}
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Replace</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Couldn&#39;t replace existing key foo&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDelete</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Delete</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;foo was found, but it should have been deleted&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x is not nil:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestItemCount</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;1&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#2aa198">&#34;2&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;baz&#34;</span>, <span style="color:#2aa198">&#34;3&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">n</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">ItemCount</span>(); <span style="color:#268bd2">n</span> != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Errorf</span>(<span style="color:#2aa198">&#34;Item count is not 3: %d&#34;</span>, <span style="color:#268bd2">n</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestFlush</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;baz&#34;</span>, <span style="color:#2aa198">&#34;yes&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Flush</span>()
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;foo was found, but it should have been deleted&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x is not nil:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;baz&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;baz was found, but it should have been deleted&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x is not nil:&#34;</span>, <span style="color:#268bd2">x</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementOverflowInt</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;int8&#34;</span>, <span style="color:#cb4b16">int8</span>(<span style="color:#2aa198;font-weight:bold">127</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;int8&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing int8:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">_</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;int8&#34;</span>)
	<span style="color:#859900;font-weight:bold">int8</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int8</span>)
	<span style="color:#859900">if</span> <span style="color:#859900;font-weight:bold">int8</span> != -<span style="color:#2aa198;font-weight:bold">128</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;int8 did not overflow as expected; value:&#34;</span>, <span style="color:#859900;font-weight:bold">int8</span>)
	}

}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestIncrementOverflowUint</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>, <span style="color:#cb4b16">uint8</span>(<span style="color:#2aa198;font-weight:bold">255</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Increment</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error incrementing int8:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">_</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>)
	<span style="color:#859900;font-weight:bold">uint8</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint8</span>)
	<span style="color:#859900">if</span> <span style="color:#859900;font-weight:bold">uint8</span> != <span style="color:#2aa198;font-weight:bold">0</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint8 did not overflow as expected; value:&#34;</span>, <span style="color:#859900;font-weight:bold">uint8</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestDecrementUnderflowUint</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>, <span style="color:#cb4b16">uint8</span>(<span style="color:#2aa198;font-weight:bold">0</span>), <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Decrement</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error decrementing int8:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">_</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;uint8&#34;</span>)
	<span style="color:#859900;font-weight:bold">uint8</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">uint8</span>)
	<span style="color:#859900">if</span> <span style="color:#859900;font-weight:bold">uint8</span> != <span style="color:#2aa198;font-weight:bold">255</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;uint8 did not underflow as expected; value:&#34;</span>, <span style="color:#859900;font-weight:bold">uint8</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestOnEvicted</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198;font-weight:bold">3</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">onEvicted</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;tc.onEvicted is not nil&#34;</span>)
	}
	<span style="color:#268bd2">works</span> := <span style="color:#859900;font-weight:bold">false</span>
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">OnEvicted</span>(<span style="color:#859900">func</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">v</span> <span style="color:#859900">interface</span>{}) {
		<span style="color:#859900">if</span> <span style="color:#268bd2">k</span> == <span style="color:#2aa198">&#34;foo&#34;</span> &amp;&amp; <span style="color:#268bd2">v</span>.(<span style="color:#859900;font-weight:bold">int</span>) == <span style="color:#2aa198;font-weight:bold">3</span> {
			<span style="color:#268bd2">works</span> = <span style="color:#859900;font-weight:bold">true</span>
		}
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#2aa198;font-weight:bold">4</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	})
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Delete</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">_</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;bar&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">works</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;works bool not true&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>) != <span style="color:#2aa198;font-weight:bold">4</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;bar was not 4&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestCacheSerialization</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">testFillAndSerialize</span>(<span style="color:#268bd2">t</span>, <span style="color:#268bd2">tc</span>)

	<span style="color:#93a1a1;font-style:italic">// Check if gob.Register behaves properly even after multiple gob.Register
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// on c.Items (many of which will be the same type)
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">testFillAndSerialize</span>(<span style="color:#268bd2">t</span>, <span style="color:#268bd2">tc</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">testFillAndSerialize</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>, <span style="color:#268bd2">tc</span> *<span style="color:#268bd2">Cache</span>) {
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;c&#34;</span>, <span style="color:#2aa198">&#34;c&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;expired&#34;</span>, <span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;*struct&#34;</span>, &amp;<span style="color:#268bd2">TestStruct</span>{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">1</span>}, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;[]struct&#34;</span>, []<span style="color:#268bd2">TestStruct</span>{
		{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">2</span>},
		{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">3</span>},
	}, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;[]*struct&#34;</span>, []*<span style="color:#268bd2">TestStruct</span>{
		&amp;<span style="color:#268bd2">TestStruct</span>{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">4</span>},
		&amp;<span style="color:#268bd2">TestStruct</span>{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">5</span>},
	}, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;structception&#34;</span>, &amp;<span style="color:#268bd2">TestStruct</span>{
		<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">42</span>,
		<span style="color:#268bd2">Children</span>: []*<span style="color:#268bd2">TestStruct</span>{
			&amp;<span style="color:#268bd2">TestStruct</span>{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">6174</span>},
			&amp;<span style="color:#268bd2">TestStruct</span>{<span style="color:#268bd2">Num</span>: <span style="color:#2aa198;font-weight:bold">4716</span>},
		},
	}, <span style="color:#268bd2">DefaultExpiration</span>)

	<span style="color:#268bd2">fp</span> := &amp;<span style="color:#268bd2">bytes</span>.<span style="color:#268bd2">Buffer</span>{}
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Save</span>(<span style="color:#268bd2">fp</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;Couldn&#39;t save cache to fp:&#34;</span>, <span style="color:#268bd2">err</span>)
	}

	<span style="color:#268bd2">oc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Load</span>(<span style="color:#268bd2">fp</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;Couldn&#39;t load cache from fp:&#34;</span>, <span style="color:#268bd2">err</span>)
	}

	<span style="color:#268bd2">a</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">a</span>.(<span style="color:#859900;font-weight:bold">string</span>) != <span style="color:#2aa198">&#34;a&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a is not a&#34;</span>)
	}

	<span style="color:#268bd2">b</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">b</span>.(<span style="color:#859900;font-weight:bold">string</span>) != <span style="color:#2aa198">&#34;b&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b is not b&#34;</span>)
	}

	<span style="color:#268bd2">c</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;c&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;c was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">c</span>.(<span style="color:#859900;font-weight:bold">string</span>) != <span style="color:#2aa198">&#34;c&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;c is not c&#34;</span>)
	}

	&lt;-<span style="color:#268bd2">time</span>.<span style="color:#268bd2">After</span>(<span style="color:#2aa198;font-weight:bold">5</span> * <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)
	<span style="color:#268bd2">_</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;expired&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expired was found&#34;</span>)
	}

	<span style="color:#268bd2">s1</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;*struct&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;*struct was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s1</span>.(*<span style="color:#268bd2">TestStruct</span>).<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">1</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;*struct.Num is not 1&#34;</span>)
	}

	<span style="color:#268bd2">s2</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;[]struct&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;[]struct was not found&#34;</span>)
	}
	<span style="color:#268bd2">s2r</span> := <span style="color:#268bd2">s2</span>.([]<span style="color:#268bd2">TestStruct</span>)
	<span style="color:#859900">if</span> <span style="color:#cb4b16">len</span>(<span style="color:#268bd2">s2r</span>) != <span style="color:#2aa198;font-weight:bold">2</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Length of s2r is not 2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s2r</span>[<span style="color:#2aa198;font-weight:bold">0</span>].<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">2</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;s2r[0].Num is not 2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s2r</span>[<span style="color:#2aa198;font-weight:bold">1</span>].<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;s2r[1].Num is not 3&#34;</span>)
	}

	<span style="color:#268bd2">s3</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">get</span>(<span style="color:#2aa198">&#34;[]*struct&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;[]*struct was not found&#34;</span>)
	}
	<span style="color:#268bd2">s3r</span> := <span style="color:#268bd2">s3</span>.([]*<span style="color:#268bd2">TestStruct</span>)
	<span style="color:#859900">if</span> <span style="color:#cb4b16">len</span>(<span style="color:#268bd2">s3r</span>) != <span style="color:#2aa198;font-weight:bold">2</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Length of s3r is not 2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s3r</span>[<span style="color:#2aa198;font-weight:bold">0</span>].<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">4</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;s3r[0].Num is not 4&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s3r</span>[<span style="color:#2aa198;font-weight:bold">1</span>].<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">5</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;s3r[1].Num is not 5&#34;</span>)
	}

	<span style="color:#268bd2">s4</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">get</span>(<span style="color:#2aa198">&#34;structception&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;structception was not found&#34;</span>)
	}
	<span style="color:#268bd2">s4r</span> := <span style="color:#268bd2">s4</span>.(*<span style="color:#268bd2">TestStruct</span>)
	<span style="color:#859900">if</span> <span style="color:#cb4b16">len</span>(<span style="color:#268bd2">s4r</span>.<span style="color:#268bd2">Children</span>) != <span style="color:#2aa198;font-weight:bold">2</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Length of s4r.Children is not 2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s4r</span>.<span style="color:#268bd2">Children</span>[<span style="color:#2aa198;font-weight:bold">0</span>].<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">6174</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;s4r.Children[0].Num is not 6174&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">s4r</span>.<span style="color:#268bd2">Children</span>[<span style="color:#2aa198;font-weight:bold">1</span>].<span style="color:#268bd2">Num</span> != <span style="color:#2aa198;font-weight:bold">4716</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;s4r.Children[1].Num is not 4716&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestFileSerialization</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Add</span>(<span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Add</span>(<span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">f</span>, <span style="color:#268bd2">err</span> := <span style="color:#268bd2">ioutil</span>.<span style="color:#268bd2">TempFile</span>(<span style="color:#2aa198">&#34;&#34;</span>, <span style="color:#2aa198">&#34;go-cache-cache.dat&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Fatal</span>(<span style="color:#2aa198">&#34;Couldn&#39;t create cache file:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">fname</span> := <span style="color:#268bd2">f</span>.<span style="color:#268bd2">Name</span>()
	<span style="color:#268bd2">f</span>.<span style="color:#268bd2">Close</span>()
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">SaveFile</span>(<span style="color:#268bd2">fname</span>)

	<span style="color:#268bd2">oc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Add</span>(<span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#2aa198">&#34;aa&#34;</span>, <span style="color:#2aa198;font-weight:bold">0</span>) <span style="color:#93a1a1;font-style:italic">// this should not be overwritten
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">err</span> = <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">LoadFile</span>(<span style="color:#268bd2">fname</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span> != <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#268bd2">err</span>)
	}
	<span style="color:#268bd2">a</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a was not found&#34;</span>)
	}
	<span style="color:#268bd2">astr</span> := <span style="color:#268bd2">a</span>.(<span style="color:#859900;font-weight:bold">string</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">astr</span> != <span style="color:#2aa198">&#34;aa&#34;</span> {
		<span style="color:#859900">if</span> <span style="color:#268bd2">astr</span> == <span style="color:#2aa198">&#34;a&#34;</span> {
			<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a was overwritten&#34;</span>)
		} <span style="color:#859900">else</span> {
			<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a is not aa&#34;</span>)
		}
	}
	<span style="color:#268bd2">b</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">oc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b was not found&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">b</span>.(<span style="color:#859900;font-weight:bold">string</span>) != <span style="color:#2aa198">&#34;b&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b is not b&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestSerializeUnserializable</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">ch</span> := <span style="color:#cb4b16">make</span>(<span style="color:#859900">chan</span> <span style="color:#859900;font-weight:bold">bool</span>, <span style="color:#2aa198;font-weight:bold">1</span>)
	<span style="color:#268bd2">ch</span> &lt;- <span style="color:#859900;font-weight:bold">true</span>
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;chan&#34;</span>, <span style="color:#268bd2">ch</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">fp</span> := &amp;<span style="color:#268bd2">bytes</span>.<span style="color:#268bd2">Buffer</span>{}
	<span style="color:#268bd2">err</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Save</span>(<span style="color:#268bd2">fp</span>) <span style="color:#93a1a1;font-style:italic">// this should fail gracefully
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#859900">if</span> <span style="color:#268bd2">err</span>.<span style="color:#268bd2">Error</span>() != <span style="color:#2aa198">&#34;gob NewTypeObject can&#39;t handle type: chan bool&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Error from Save was not gob NewTypeObject can&#39;t handle type chan bool:&#34;</span>, <span style="color:#268bd2">err</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheGetExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheGet</span>(<span style="color:#268bd2">b</span>, <span style="color:#2aa198;font-weight:bold">5</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Minute</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheGetNotExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheGet</span>(<span style="color:#268bd2">b</span>, <span style="color:#268bd2">NoExpiration</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">benchmarkCacheGet</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>, <span style="color:#268bd2">exp</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">exp</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexMapGet</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{
		<span style="color:#2aa198">&#34;foo&#34;</span>: <span style="color:#2aa198">&#34;bar&#34;</span>,
	}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RLock</span>()
		<span style="color:#268bd2">_</span>, <span style="color:#268bd2">_</span> = <span style="color:#268bd2">m</span>[<span style="color:#2aa198">&#34;foo&#34;</span>]
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RUnlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexInterfaceMapGetStruct</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">s</span> := <span style="color:#859900">struct</span>{ <span style="color:#268bd2">name</span> <span style="color:#859900;font-weight:bold">string</span> }{<span style="color:#268bd2">name</span>: <span style="color:#2aa198">&#34;foo&#34;</span>}
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900">interface</span>{}]<span style="color:#859900;font-weight:bold">string</span>{
		<span style="color:#268bd2">s</span>: <span style="color:#2aa198">&#34;bar&#34;</span>,
	}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RLock</span>()
		<span style="color:#268bd2">_</span>, <span style="color:#268bd2">_</span> = <span style="color:#268bd2">m</span>[<span style="color:#268bd2">s</span>]
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RUnlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexInterfaceMapGetString</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900">interface</span>{}]<span style="color:#859900;font-weight:bold">string</span>{
		<span style="color:#2aa198">&#34;foo&#34;</span>: <span style="color:#2aa198">&#34;bar&#34;</span>,
	}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RLock</span>()
		<span style="color:#268bd2">_</span>, <span style="color:#268bd2">_</span> = <span style="color:#268bd2">m</span>[<span style="color:#2aa198">&#34;foo&#34;</span>]
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RUnlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheGetConcurrentExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheGetConcurrent</span>(<span style="color:#268bd2">b</span>, <span style="color:#2aa198;font-weight:bold">5</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Minute</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheGetConcurrentNotExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheGetConcurrent</span>(<span style="color:#268bd2">b</span>, <span style="color:#268bd2">NoExpiration</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">benchmarkCacheGetConcurrent</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>, <span style="color:#268bd2">exp</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">exp</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">wg</span> := <span style="color:#cb4b16">new</span>(<span style="color:#268bd2">sync</span>.<span style="color:#268bd2">WaitGroup</span>)
	<span style="color:#268bd2">workers</span> := <span style="color:#268bd2">runtime</span>.<span style="color:#268bd2">NumCPU</span>()
	<span style="color:#268bd2">each</span> := <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span> / <span style="color:#268bd2">workers</span>
	<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Add</span>(<span style="color:#268bd2">workers</span>)
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">workers</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#859900">go</span> <span style="color:#859900">func</span>() {
			<span style="color:#859900">for</span> <span style="color:#268bd2">j</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">j</span> &lt; <span style="color:#268bd2">each</span>; <span style="color:#268bd2">j</span>++ {
				<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
			}
			<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Done</span>()
		}()
	}
	<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Wait</span>()
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexMapGetConcurrent</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{
		<span style="color:#2aa198">&#34;foo&#34;</span>: <span style="color:#2aa198">&#34;bar&#34;</span>,
	}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">wg</span> := <span style="color:#cb4b16">new</span>(<span style="color:#268bd2">sync</span>.<span style="color:#268bd2">WaitGroup</span>)
	<span style="color:#268bd2">workers</span> := <span style="color:#268bd2">runtime</span>.<span style="color:#268bd2">NumCPU</span>()
	<span style="color:#268bd2">each</span> := <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span> / <span style="color:#268bd2">workers</span>
	<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Add</span>(<span style="color:#268bd2">workers</span>)
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">workers</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#859900">go</span> <span style="color:#859900">func</span>() {
			<span style="color:#859900">for</span> <span style="color:#268bd2">j</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">j</span> &lt; <span style="color:#268bd2">each</span>; <span style="color:#268bd2">j</span>++ {
				<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RLock</span>()
				<span style="color:#268bd2">_</span>, <span style="color:#268bd2">_</span> = <span style="color:#268bd2">m</span>[<span style="color:#2aa198">&#34;foo&#34;</span>]
				<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">RUnlock</span>()
			}
			<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Done</span>()
		}()
	}
	<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Wait</span>()
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheGetManyConcurrentExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheGetManyConcurrent</span>(<span style="color:#268bd2">b</span>, <span style="color:#2aa198;font-weight:bold">5</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Minute</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheGetManyConcurrentNotExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheGetManyConcurrent</span>(<span style="color:#268bd2">b</span>, <span style="color:#268bd2">NoExpiration</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">benchmarkCacheGetManyConcurrent</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>, <span style="color:#268bd2">exp</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#93a1a1;font-style:italic">// This is the same as BenchmarkCacheGetConcurrent, but its result
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// can be compared against BenchmarkShardedCacheGetManyConcurrent
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#93a1a1;font-style:italic">// in sharded_test.go.
</span><span style="color:#93a1a1;font-style:italic"></span>	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">n</span> := <span style="color:#2aa198;font-weight:bold">10000</span>
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">exp</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">keys</span> := <span style="color:#cb4b16">make</span>([]<span style="color:#859900;font-weight:bold">string</span>, <span style="color:#268bd2">n</span>)
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">n</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">k</span> := <span style="color:#2aa198">&#34;foo&#34;</span> + <span style="color:#268bd2">strconv</span>.<span style="color:#268bd2">Itoa</span>(<span style="color:#268bd2">i</span>)
		<span style="color:#268bd2">keys</span>[<span style="color:#268bd2">i</span>] = <span style="color:#268bd2">k</span>
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#268bd2">k</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	}
	<span style="color:#268bd2">each</span> := <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span> / <span style="color:#268bd2">n</span>
	<span style="color:#268bd2">wg</span> := <span style="color:#cb4b16">new</span>(<span style="color:#268bd2">sync</span>.<span style="color:#268bd2">WaitGroup</span>)
	<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Add</span>(<span style="color:#268bd2">n</span>)
	<span style="color:#859900">for</span> <span style="color:#268bd2">_</span>, <span style="color:#268bd2">v</span> := <span style="color:#859900">range</span> <span style="color:#268bd2">keys</span> {
		<span style="color:#859900">go</span> <span style="color:#859900">func</span>(<span style="color:#268bd2">k</span> <span style="color:#859900;font-weight:bold">string</span>) {
			<span style="color:#859900">for</span> <span style="color:#268bd2">j</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">j</span> &lt; <span style="color:#268bd2">each</span>; <span style="color:#268bd2">j</span>++ {
				<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Get</span>(<span style="color:#268bd2">k</span>)
			}
			<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Done</span>()
		}(<span style="color:#268bd2">v</span>)
	}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#268bd2">wg</span>.<span style="color:#268bd2">Wait</span>()
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheSetExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheSet</span>(<span style="color:#268bd2">b</span>, <span style="color:#2aa198;font-weight:bold">5</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Minute</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheSetNotExpiring</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">benchmarkCacheSet</span>(<span style="color:#268bd2">b</span>, <span style="color:#268bd2">NoExpiration</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">benchmarkCacheSet</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>, <span style="color:#268bd2">exp</span> <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Duration</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">exp</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexMapSet</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
		<span style="color:#268bd2">m</span>[<span style="color:#2aa198">&#34;foo&#34;</span>] = <span style="color:#2aa198">&#34;bar&#34;</span>
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheSetDelete</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Delete</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexMapSetDelete</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
		<span style="color:#268bd2">m</span>[<span style="color:#2aa198">&#34;foo&#34;</span>] = <span style="color:#2aa198">&#34;bar&#34;</span>
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
		<span style="color:#cb4b16">delete</span>(<span style="color:#268bd2">m</span>, <span style="color:#2aa198">&#34;foo&#34;</span>)
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkCacheSetDeleteSingleLock</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">set</span>(<span style="color:#2aa198">&#34;foo&#34;</span>, <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
		<span style="color:#268bd2">tc</span>.<span style="color:#cb4b16">delete</span>(<span style="color:#2aa198">&#34;foo&#34;</span>)
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkRWMutexMapSetDeleteSingleLock</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">m</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{}
	<span style="color:#268bd2">mu</span> := <span style="color:#268bd2">sync</span>.<span style="color:#268bd2">RWMutex</span>{}
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
		<span style="color:#268bd2">m</span>[<span style="color:#2aa198">&#34;foo&#34;</span>] = <span style="color:#2aa198">&#34;bar&#34;</span>
		<span style="color:#cb4b16">delete</span>(<span style="color:#268bd2">m</span>, <span style="color:#2aa198">&#34;foo&#34;</span>)
		<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">BenchmarkDeleteExpiredLoop</span>(<span style="color:#268bd2">b</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">B</span>) {
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StopTimer</span>()
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#2aa198;font-weight:bold">5</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Minute</span>, <span style="color:#2aa198;font-weight:bold">0</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Lock</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#2aa198;font-weight:bold">100000</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">set</span>(<span style="color:#268bd2">strconv</span>.<span style="color:#268bd2">Itoa</span>(<span style="color:#268bd2">i</span>), <span style="color:#2aa198">&#34;bar&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	}
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">mu</span>.<span style="color:#268bd2">Unlock</span>()
	<span style="color:#268bd2">b</span>.<span style="color:#268bd2">StartTimer</span>()
	<span style="color:#859900">for</span> <span style="color:#268bd2">i</span> := <span style="color:#2aa198;font-weight:bold">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">b</span>.<span style="color:#268bd2">N</span>; <span style="color:#268bd2">i</span>++ {
		<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">DeleteExpired</span>()
	}
}

<span style="color:#859900">func</span> <span style="color:#268bd2">TestGetWithExpiration</span>(<span style="color:#268bd2">t</span> *<span style="color:#268bd2">testing</span>.<span style="color:#268bd2">T</span>) {
	<span style="color:#268bd2">tc</span> := <span style="color:#268bd2">New</span>(<span style="color:#268bd2">DefaultExpiration</span>, <span style="color:#2aa198;font-weight:bold">0</span>)

	<span style="color:#268bd2">a</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> || <span style="color:#268bd2">a</span> != <span style="color:#859900;font-weight:bold">nil</span> || !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Getting A found value that shouldn&#39;t exist:&#34;</span>, <span style="color:#268bd2">a</span>)
	}

	<span style="color:#268bd2">b</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> || <span style="color:#268bd2">b</span> != <span style="color:#859900;font-weight:bold">nil</span> || !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Getting B found value that shouldn&#39;t exist:&#34;</span>, <span style="color:#268bd2">b</span>)
	}

	<span style="color:#268bd2">c</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;c&#34;</span>)
	<span style="color:#859900">if</span> <span style="color:#268bd2">found</span> || <span style="color:#268bd2">c</span> != <span style="color:#859900;font-weight:bold">nil</span> || !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;Getting C found value that shouldn&#39;t exist:&#34;</span>, <span style="color:#268bd2">c</span>)
	}

	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;a&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#2aa198">&#34;b&#34;</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;c&#34;</span>, <span style="color:#2aa198;font-weight:bold">3.5</span>, <span style="color:#268bd2">DefaultExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;d&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>, <span style="color:#268bd2">NoExpiration</span>)
	<span style="color:#268bd2">tc</span>.<span style="color:#268bd2">Set</span>(<span style="color:#2aa198">&#34;e&#34;</span>, <span style="color:#2aa198;font-weight:bold">1</span>, <span style="color:#2aa198;font-weight:bold">50</span>*<span style="color:#268bd2">time</span>.<span style="color:#268bd2">Millisecond</span>)

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> := <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;a&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a was not found while getting a2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for a is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">a2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>); <span style="color:#268bd2">a2</span>+<span style="color:#2aa198;font-weight:bold">2</span> != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;a2 (which should be 1) plus 2 does not equal 3; value:&#34;</span>, <span style="color:#268bd2">a2</span>)
	}
	<span style="color:#859900">if</span> !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expiration for a is not a zeroed time&#34;</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;b&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b was not found while getting b2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for b is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">b2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">string</span>); <span style="color:#268bd2">b2</span>+<span style="color:#2aa198">&#34;B&#34;</span> != <span style="color:#2aa198">&#34;bB&#34;</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;b2 (which should be b) plus B does not equal bB; value:&#34;</span>, <span style="color:#268bd2">b2</span>)
	}
	<span style="color:#859900">if</span> !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expiration for b is not a zeroed time&#34;</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;c&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;c was not found while getting c2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for c is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">c2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">float64</span>); <span style="color:#268bd2">c2</span>+<span style="color:#2aa198;font-weight:bold">1.2</span> != <span style="color:#2aa198;font-weight:bold">4.7</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;c2 (which should be 3.5) plus 1.2 does not equal 4.7; value:&#34;</span>, <span style="color:#268bd2">c2</span>)
	}
	<span style="color:#859900">if</span> !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expiration for c is not a zeroed time&#34;</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;d&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;d was not found while getting d2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for d is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">d2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>); <span style="color:#268bd2">d2</span>+<span style="color:#2aa198;font-weight:bold">2</span> != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;d (which should be 1) plus 2 does not equal 3; value:&#34;</span>, <span style="color:#268bd2">d2</span>)
	}
	<span style="color:#859900">if</span> !<span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">IsZero</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expiration for d is not a zeroed time&#34;</span>)
	}

	<span style="color:#268bd2">x</span>, <span style="color:#268bd2">expiration</span>, <span style="color:#268bd2">found</span> = <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">GetWithExpiration</span>(<span style="color:#2aa198">&#34;e&#34;</span>)
	<span style="color:#859900">if</span> !<span style="color:#268bd2">found</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;e was not found while getting e2&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">x</span> == <span style="color:#859900;font-weight:bold">nil</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;x for e is nil&#34;</span>)
	} <span style="color:#859900">else</span> <span style="color:#859900">if</span> <span style="color:#268bd2">e2</span> := <span style="color:#268bd2">x</span>.(<span style="color:#859900;font-weight:bold">int</span>); <span style="color:#268bd2">e2</span>+<span style="color:#2aa198;font-weight:bold">2</span> != <span style="color:#2aa198;font-weight:bold">3</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;e (which should be 1) plus 2 does not equal 3; value:&#34;</span>, <span style="color:#268bd2">e2</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">UnixNano</span>() != <span style="color:#268bd2">tc</span>.<span style="color:#268bd2">items</span>[<span style="color:#2aa198">&#34;e&#34;</span>].<span style="color:#268bd2">Expiration</span> {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expiration for e is not the correct time&#34;</span>)
	}
	<span style="color:#859900">if</span> <span style="color:#268bd2">expiration</span>.<span style="color:#268bd2">UnixNano</span>() &lt; <span style="color:#268bd2">time</span>.<span style="color:#268bd2">Now</span>().<span style="color:#268bd2">UnixNano</span>() {
		<span style="color:#268bd2">t</span>.<span style="color:#268bd2">Error</span>(<span style="color:#2aa198">&#34;expiration for e is in the past&#34;</span>)
	}
}</code></pre></div>

        
          <div class="blog-tags">
            
              <a href="https://driverzhang.github.io//tags/golang/">golang</a>&nbsp;
            
              <a href="https://driverzhang.github.io//tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <ul class="list-inline footer-links">
                


<li>
    <a href="//twitter.com/share?url=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;text=Golang%e5%86%99%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e9%94%ae%e5%80%bc%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f&amp;via="
       target="_blank" alt="" title="Share on Twitter">
        <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>


<li>
    <a href="//plus.google.com/share?url=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f" target="_blank" title="Share on Google Plus">
         <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>


<li>
    <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f" target="_blank" title="Share on Facebook">
        <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>


<li>
    <a href="//reddit.com/submit?url=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;title=Golang%e5%86%99%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e9%94%ae%e5%80%bc%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f" target="_blank" title="Share on Reddit">
         <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-reddit fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>


<li>
    <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;title=Golang%e5%86%99%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e9%94%ae%e5%80%bc%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f" target="_blank"
       title="Share on LinkedIn">
         <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>


<li>
    <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;title=Golang%e5%86%99%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e9%94%ae%e5%80%bc%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f" target="_blank"
       title="Share on StumbleUpon">
        <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stumbleupon fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>


<li>
    <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fdriverzhang.github.io%2fpost%2fgolang%25E5%2586%2599%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584%25E9%2594%25AE%25E5%2580%25BC%25E5%25AD%2598%25E5%2582%25A8%25E7%25B3%25BB%25E7%25BB%259F%2f&amp;description=Golang%e5%86%99%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e9%94%ae%e5%80%bc%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f" target="_blank"
       title="Share on Pinterest">
         <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-pinterest fa-stack-1x fa-inverse"></i>
              </span>
    </a>
</li>

              </ul>
            </section>
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://driverzhang.github.io/post/mongo%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1%E4%B9%8B%E5%89%AF%E6%9C%AC%E9%9B%86%E9%87%87%E5%9D%91/" data-toggle="tooltip" data-placement="top" title="Mongo开启事务之副本集采坑">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://www.facebook.com/xiaoxin.zhang" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/driverzhang" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            
            <a href="https://driverzhang.github.io/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Gopherzhang
            
          

          &nbsp;&bull;&nbsp;
          2020

          
            &nbsp;&bull;&nbsp;
            <a href="https://driverzhang.github.io/">Gopherzhang</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.48</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://driverzhang.github.io/js/main.js"></script>
<script src="https://driverzhang.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://driverzhang.github.io/js/load-photoswipe.js"></script>






  </body>
</html>

